<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ml/crop_segmentation &mdash; FarmVibes.AI  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom.css?v=85179c66" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            FarmVibes.AI
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guides &amp; Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../QUICKSTART.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../AKS.html">Remote Cluster User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CLIENT.html">FarmVibes.AI Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WORKFLOWS.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NOTEBOOK_LIST.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../REST_API.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CACHE.html">Data Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SECRETS.html">Secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../TROUBLESHOOTING.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/client.html">FarmVibes.AI Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_data/index_data_types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WORKFLOW_LIST.html">Workflow List</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/admag_client.html">Azure Data Manager for Agriculture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/datamodel.html">Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/additional_modules/filedownloader.html">File Downloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/additional_modules/fileutils.html">File Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/additional_modules/logconfig.html">Logconfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/additional_modules/monitor.html">Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/additional_modules/uri.html">URI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code/vibe_core_client/additional_modules/utils.html">Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">FarmVibes.AI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">ml/crop_segmentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docfiles/markdown/workflow_yaml/ml/crop_segmentation.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ml-crop-segmentation">
<h1>ml/crop_segmentation<a class="headerlink" href="#ml-crop-segmentation" title="Permalink to this heading"></a></h1>
<p>Runs a crop segmentation model based on NDVI from SpaceEye imagery along the year. The workflow generates SpaceEye cloud-free data for the input region and time range and computes NDVI over those. NDVI values sampled regularly along the year are stacked as bands and used as input to the crop segmentation model.</p>
<div class="mermaid">
                graph TD
    inp1&gt;user_input]
    out1&gt;segmentation]
    tsk1{{spaceeye}}
    tsk2{{ndvi}}
    tsk3{{group}}
    tsk4{{inference}}
    tsk1{{spaceeye}} -- raster --&gt; tsk2{{ndvi}}
    tsk2{{ndvi}} -- index_raster/rasters --&gt; tsk3{{group}}
    tsk3{{group}} -- sequence/input_raster --&gt; tsk4{{inference}}
    inp1&gt;user_input] -- user_input --&gt; tsk1{{spaceeye}}
    tsk4{{inference}} -- output_raster --&gt; out1&gt;segmentation]
        </div><section id="sources">
<h2>Sources<a class="headerlink" href="#sources" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>user_input</strong>: Time range and geometry of interest.</p></li>
</ul>
</section>
<section id="sinks">
<h2>Sinks<a class="headerlink" href="#sinks" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>segmentation</strong>: Crop segmentation map at 10m resolution.</p></li>
</ul>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>pc_key</strong>: Optional Planetary Computer API key.</p></li>
<li><p><strong>model_file</strong>: Path to the ONNX file containing the model architecture and weights.</p></li>
<li><p><strong>model_bands</strong>: Number of NDVI bands to stack as the model input.</p></li>
</ul>
</section>
<section id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>spaceeye</strong>: Runs the SpaceEye cloud removal pipeline using an interpolation-based algorithm, yielding daily cloud-free images for the input geometry and time range.</p></li>
<li><p><strong>ndvi</strong>: Computes an index from the bands of an input raster.</p></li>
<li><p><strong>group</strong>: Selects “num” entries from a Raster list so that the output sequence has a fixed length.</p></li>
<li><p><strong>inference</strong>: Processes a sequence of rasters with an ONNX model.</p></li>
</ul>
</section>
<section id="workflow-yaml">
<h2>Workflow Yaml<a class="headerlink" href="#workflow-yaml" title="Permalink to this heading"></a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">crop_segmentation</span>
<span class="nt">sources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">user_input</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spaceeye.user_input</span>
<span class="nt">sinks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">segmentation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inference.output_raster</span>
<span class="nt">parameters</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pc_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">model_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">model_bands</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">37</span>
<span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">spaceeye</span><span class="p">:</span>
<span class="w">    </span><span class="nt">workflow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data_ingestion/spaceeye/spaceeye_interpolation</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pc_key</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;@from(pc_key)&#39;</span>
<span class="w">  </span><span class="nt">ndvi</span><span class="p">:</span>
<span class="w">    </span><span class="nt">workflow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data_processing/index/index</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ndvi</span>
<span class="w">  </span><span class="nt">group</span><span class="p">:</span>
<span class="w">    </span><span class="nt">op</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select_sequence_from_list</span>
<span class="w">    </span><span class="nt">op_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">select_sequence</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">num</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;@from(model_bands)&#39;</span>
<span class="w">      </span><span class="nt">criterion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">regular</span>
<span class="w">  </span><span class="nt">inference</span><span class="p">:</span>
<span class="w">    </span><span class="nt">op</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute_onnx_from_sequence</span>
<span class="w">    </span><span class="nt">op_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute_onnx</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;@from(model_file)&#39;</span>
<span class="w">      </span><span class="nt">window_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
<span class="w">      </span><span class="nt">overlap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.25</span>
<span class="w">      </span><span class="nt">num_workers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="nt">edges</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">origin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spaceeye.raster</span>
<span class="w">  </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ndvi.raster</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">origin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ndvi.index_raster</span>
<span class="w">  </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">group.rasters</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">origin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">group.sequence</span>
<span class="w">  </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inference.input_raster</span>
<span class="nt">description</span><span class="p">:</span>
<span class="w">  </span><span class="nt">short_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Runs a crop segmentation model based on NDVI from SpaceEye imagery</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">along the year.</span>
<span class="w">  </span><span class="nt">long_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The workflow generates SpaceEye cloud-free data for the input</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">region and time range and computes NDVI over those. NDVI values sampled regularly</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">along the year are stacked as bands and used as input to the crop segmentation</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">model.</span>
<span class="w">  </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">user_input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Time range and geometry of interest.</span>
<span class="w">  </span><span class="nt">sinks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">segmentation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Crop segmentation map at 10m resolution.</span>
<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pc_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Optional Planetary Computer API key.</span>
<span class="w">    </span><span class="nt">model_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Path to the ONNX file containing the model architecture and weights.</span>
<span class="w">    </span><span class="nt">model_bands</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Number of NDVI bands to stack as the model input.</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Microsoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>