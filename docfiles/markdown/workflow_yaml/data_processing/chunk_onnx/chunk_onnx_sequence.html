<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>data_processing/chunk_onnx/chunk_onnx_sequence &mdash; FarmVibes.AI  documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
        <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            FarmVibes.AI
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guides &amp; Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../QUICKSTART.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../AKS.html">Remote Cluster User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CLIENT.html">FarmVibes.AI Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../WORKFLOWS.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../NOTEBOOK_LIST.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../REST_API.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CACHE.html">Data Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../SECRETS.html">Secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Main Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/client.html">FarmVibes.AI Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_data/index_data_types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../WORKFLOW_LIST.html">Workflow List</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supporting Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/admag_client.html">Azure Data Manager for Agriculture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/datamodel.html">Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/additional_modules/filedownloader.html">File Downloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/additional_modules/fileutils.html">File Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/additional_modules/logconfig.html">Logconfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/additional_modules/monitor.html">Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/additional_modules/uri.html">URI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../code/vibe_core_client/additional_modules/utils.html">Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">FarmVibes.AI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">data_processing/chunk_onnx/chunk_onnx_sequence</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docfiles/markdown/workflow_yaml/data_processing/chunk_onnx/chunk_onnx_sequence.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-processing-chunk-onnx-chunk-onnx-sequence">
<h1>data_processing/chunk_onnx/chunk_onnx_sequence<a class="headerlink" href="#data-processing-chunk-onnx-chunk-onnx-sequence" title="Permalink to this heading"></a></h1>
<p>Runs an Onnx model over all rasters in the input to produce a single raster. This workflow is intended to run an Onnx model on all input rasters to produce a single raster output. This can be used, for instance, to compute time-series analysis of a list of rasters that span multiple times. The analysis can be any computation that can be expressed as an Onnx model (for an example, see notebooks/crop_cycles/crop_cycles.ipynb). In order to run the model in parallel (and avoid running out of memory if the list of rasters is large), the input rasters are divided spatially into chunks (that span all times). The Onnx model is applied to these chunks and then combined back to produce the final output.</p>
<div class="mermaid">
                graph TD
    inp1&gt;rasters]
    out1&gt;raster]
    tsk1{{chunk_raster}}
    tsk2{{compute_onnx}}
    tsk3{{combine_chunks}}
    tsk1{{chunk_raster}} -- chunk_series/chunk --&gt; tsk2{{compute_onnx}}
    tsk2{{compute_onnx}} -- output_raster/chunks --&gt; tsk3{{combine_chunks}}
    inp1&gt;rasters] -- rasters --&gt; tsk1{{chunk_raster}}
    inp1&gt;rasters] -- input_raster --&gt; tsk2{{compute_onnx}}
    tsk3{{combine_chunks}} -- raster --&gt; out1&gt;raster]
        </div><section id="sources">
<h2>Sources<a class="headerlink" href="#sources" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>rasters</strong>: Input rasters.</p></li>
</ul>
</section>
<section id="sinks">
<h2>Sinks<a class="headerlink" href="#sinks" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>raster</strong>: Result of the Onnx model run.</p></li>
</ul>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>model_file</strong>: An Onnx model which needs to be deployed with “farmvibes-ai local add-onnx” command.</p></li>
<li><p><strong>step</strong>: Size of the chunk in pixels.</p></li>
</ul>
</section>
<section id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>chunk_raster</strong>: Splits input rasters into a series of chunks.</p></li>
<li><p><strong>compute_onnx</strong>: Runs the onnx model across chunks of the input rasters.</p></li>
<li><p><strong>combine_chunks</strong>: Combines series of chunks into a final raster.</p></li>
</ul>
</section>
<section id="workflow-yaml">
<h2>Workflow Yaml<a class="headerlink" href="#workflow-yaml" title="Permalink to this heading"></a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chunk_onnx_sequence</span>
<span class="nt">sources</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rasters</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chunk_raster.rasters</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute_onnx.input_raster</span>
<span class="nt">sinks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">raster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">combine_chunks.raster</span>
<span class="nt">parameters</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">step</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">chunk_raster</span><span class="p">:</span>
<span class="w">    </span><span class="nt">op</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chunk_sequence_raster</span>
<span class="w">    </span><span class="nt">op_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chunk_raster</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">step_y</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;@from(step)&#39;</span>
<span class="w">      </span><span class="nt">step_x</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;@from(step)&#39;</span>
<span class="w">  </span><span class="nt">compute_onnx</span><span class="p">:</span>
<span class="w">    </span><span class="nt">op</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute_onnx_from_chunks</span>
<span class="w">    </span><span class="nt">op_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute_onnx</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">model_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;@from(model_file)&#39;</span>
<span class="w">      </span><span class="nt">window_size</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;@from(step)&#39;</span>
<span class="w">  </span><span class="nt">combine_chunks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">op</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">combine_chunks</span>
<span class="nt">edges</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">origin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chunk_raster.chunk_series</span>
<span class="w">  </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute_onnx.chunk</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">origin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute_onnx.output_raster</span>
<span class="w">  </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">combine_chunks.chunks</span>
<span class="nt">description</span><span class="p">:</span>
<span class="w">  </span><span class="nt">short_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Runs an Onnx model over all rasters in the input to produce a</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">single raster.</span>
<span class="w">  </span><span class="nt">long_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This workflow is intended to run an Onnx model on all input rasters</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">to produce a single raster output. This can be used, for instance, to compute</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">time-series analysis of a list of rasters that span multiple times. The analysis</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">can be any computation that can be expressed as an Onnx model (for an example,</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">see notebooks/crop_cycles/crop_cycles.ipynb). In order to run the model in parallel</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">(and avoid running out of memory if the list of rasters is large), the input rasters</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">are divided spatially into chunks (that span all times). The Onnx model is applied</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">to these chunks and then combined back to produce the final output.</span>
<span class="w">  </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">rasters</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Input rasters.</span>
<span class="w">  </span><span class="nt">sinks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">raster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Result of the Onnx model run.</span>
<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">model_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">An Onnx model which needs to be deployed with &quot;farmvibes-ai local</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">add-onnx&quot; command.</span>
<span class="w">    </span><span class="nt">step</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Size of the chunk in pixels.</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Microsoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>